#!/usr/bin/env bash

set -eu

if test -z "$1"; then
    echo "Missing argument, e.g. $0 classic/Fastbind" >&2
    exit 1
fi

if ! test -d "$1"; then
    echo "$1 is not a directory" >&2
    exit 1
fi

platform="$(dirname "$1")"
name="$(basename "$1")"
version="$(grep -Po "Version: \K.+" "$platform/$name/$name.toc")"
tag="$platform/$name/$version"

if git tag "$tag" > /dev/null 2>&1; then
    git push --tags
else
    echo "Tag $tag already exists." >&2
fi